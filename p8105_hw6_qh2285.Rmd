---
title: "p8105_hw6_qh2285"
author: "Qianxuan Huang"
date: "2024-12-01"
output: html_document
---

```{r, include=FALSE}
library(tidyverse)
library(readxl)
library(modelr)
library(mgcv)
knitr::opts_chunk$set(
	warning = FALSE,
	message = FALSE,
	fig.width = 8, 
	fig.height = 6)

theme_set(theme_minimal())
```


## Problem 1

```{r weather_data import}
weather_df = 
  rnoaa::meteo_pull_monitors(
    c("USW00094728"),
    var = c("PRCP", "TMIN", "TMAX"), 
    date_min = "2017-01-01",
    date_max = "2017-12-31") %>%
  mutate(
    name = recode(id, USW00094728 = "CentralPark_NY"),
    tmin = tmin / 10,
    tmax = tmax / 10) %>%
  select(name, id, everything())
```


```{r bootstrap}
bootstrap_results <-
  weather_df |> 
  modelr::bootstrap(n = 5000) |> 
  mutate(
    models = map(strap, \(df) lm(tmax ~ tmin + prcp, data = df)),
    summary = map(models, broom::glance),
    results = map(models, broom::tidy)) |> 
  select(-models) |> 
  unnest(summary, results) |> 
  select(id = .id, r.squared, term, estimate) |> 
  pivot_wider(
    names_from = term,
    values_from = estimate) |> 
  mutate(
    log_b1b2 = log(tmin * prcp)
  ) |> 
  select(id, r.squared, log_b1b2)
```


```{r conf for r2}
bootstrap_results |> 
  ggplot(aes(x = r.squared)) + geom_density() + 
  labs(title = "Distribution of estimated r square")

LB_r = bootstrap_results |> pull(r.squared) |>  quantile(0.025)
UB_r =bootstrap_results |> pull(r.squared) |>  quantile(0.975)

c(LB_r, UB_r)|> 
  knitr::kable(digits = 3)
```

Comments: The distribution of $\hat{r^2}$ shows a mild skewness towards the left, spanning between 0.86 and 0.96, with its most frequent value approximately at 0.92. The lower and upper bounds of its 95% confidence interval, marked by the 2.5% and 97.5% quantiles, are `r LB_r |> round(3)` and `r UB_r |> round(3)`, respectively. This interval can be denoted as (`r LB_r |> round(3)`, `r UB_r |> round(3)`).


```{r conf for logb1b2}
bootstrap_results |> 
  filter(log_b1b2 != "NaN") |> 
  ggplot(aes(x = log_b1b2)) + geom_density() +
  labs(title = "Distribution of estimated log(beta1 * beta2)")

LB_b = bootstrap_results |> filter(log_b1b2 != "NaN") |> pull(log_b1b2) |>  quantile(0.025)
UB_b =bootstrap_results |> filter(log_b1b2 != "NaN") |> pull(log_b1b2) |>  quantile(0.975)

c(LB_b, UB_b)|> 
  knitr::kable(digits = 3)
```


The distribution of $log(\hat{\beta_1} * \hat{\beta_2})$ exhibits a pronounced left-skew, stretching from -12 to -4, and predominantly centers around -5.5. The distribution's 2.5% and 97.5% quantiles are `r LB_b |> round(3)` and `r UB_b |> round(3)`, respectively, defining a 95% confidence interval represented as (`r LB_b |> round(3)`, `r UB_b |> round(3)`).
